# ch03. 역할, 책임, 협력

### 객체지향 패러다임의 관점에서 핵심은 역할(role), 책임(responsibility), 협력(collaboration)
> TL; DR

```
협력: 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용
책임: 객체가 협력에 참여하기 위해 수행하는 로직
역할: 객체들이 협력 안에서 수행하는 책임들의 모임
```

## 협력

- 메시지 전송(message sending)은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다.
- 두 객체 사이의 협력은 하나의 객체가 다른 객체에게 도움을 요청할 때 시작된다.
- 메시지를 수신한 객체는 **메서드**를 실행해 요청에 응답한다.

상영을 담당하는 Screening과 영화요금계산을 담당하는 Movie 객체가 서로 있다고 할 때, 각자의 자율성이 훼손되지 않게끔 자신의 상태를 직접 관리하고 스스로의 결정에 따라 행동해야 한다. (Screening이 요금을 계산하지 않게, Movie가 상영시간, 상영관 등의 디테일 정보를 담고있지 않게)

객체를 자율적으로 만드는 가장 기본적인 방법은 **캡슐화**이다. 

### 협력이 설계를 위한 문맥을 결정한다

> 어떤 객체도 섬이 아니다.
> 

객체의 **행동**을 결정하는 것은 객체가 참여하고 있는 **협력**이다.

객체의 행동을 결정하는 것이 협력이라면, 객체의 **상태**를 결정하는 것은 **행동**이다.

> 협력 > 행동 > 상태
> 

상태는 객체가 행동하는데 필요한 정보에 의해 결정되고, 행동은 협력 안에서 객체가 처리할 메시지로 결정된다.

## 책임

객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 유지해야하는 정보와 수행할 수 있는 행동에 대해 개략적으로 서술한 문장이다.

객체의 책임은 크게 두가지로 나누어 볼 수 있다.

- 하는 것
    - 객체를 생성하거나 계산을 수행하는 등 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것
    - 사적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

영화 예매 시스템을 예로 들어본다면 

Screening의 책임: 영화를 예매하는 것 / 자신이 상영할 영화를 아는 것

Movie의 책임: 요금을 계산하는 것 / 가격, 할인 정책을 아는 것

책임과 메시지의 크기는 다르다. 책임은 객체가 수행할 수 있는 행동을 종합적이고 간략하게 서술하기 때문에 메시지보다 추상적이고 개념적으로 더 크다.

*객체에게 얼마나 적절한 책임을 할당하느냐가 설계의 전체적인 품질을 결정한다.*

### 책임 할당

자율적인 객체를 만드는 가장 기본적인 방법은 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것이다. → 책임할당을 위한 **INFORMATION EXPERT(정보 전문가)** 패턴

### 책임 주도 설계

*책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법*

- 시스템이 사용자에게 제공해야하는 기능인 시스템 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 된다.

### 메시지가 객체를 결정한다

메시지가 객체를 선택해야 하는 두 가지 중요한 이유

1. 객체가 최소한의 인터페이스(minimal interface)를 가질 수 있게 된다.
2. 객체는 충분히 추상적인 인터페이스(abstract interface)를 가질 수 있게 된다.

### 행동이 상태를 결정한다

객체가 존재하는 이유는 협력하기 위해서이고, 협력에 필요한 행동을 제공함으로써 객체를 객체답게 만드는 것이다. 객체의 상태가 아니라.

객체의 상태에 초점을 맞추게 되면 객체의 내부구현이 밖으로 드러나게 되고, 이는 **캡슐화**를 저해한다. 이는 객체의 내부 구현을 변경하면 퍼블릭 인터페이스도 변경해야 하고 해당 인터페이스에 의존하는 클라이언트까지 변경의 영향이 전파됨을 의미한다.

## 역할

### 역할과 협력

역할은 특정한 협력안에서 수행하는 책임의 집합이다. 우리는 실제로 협력을 모델링 할 때 특정한 객체가 아니라 역할에게 책임을 할당한다고 생각하는 것이 좋다.

영화 예매 협력에서 *예매하라*라는 메시지를 처리하기에 적합한 객체로 Screening을 선택했다. 이 선택은 사실 두 개의 독립적인 단계가 합쳐진 것이다.

1. 영화를 예매할 수 있는 적절한 **역할**이 무엇인가?
2. 역할을 수행할 객체로 {Screening} 인스턴스를 선택

### 역할이 중요한 이유

Movie가 할인 요금을 계산하라는 명령을 고정금액할인, 비율금액할인 두 개의 상황시에 모두 고정금액할인객체, 비율금액할인객체에게 명령을 보내는 로직이 ‘따로' 존재한다고 하면 코드의 중복이 발생한다.

하지만 **금액할인**이라는 역할을 인터페이스로 만들고 내부 구현을 각각의 고정금액할인, 비율금액할인으로 분기처리를 한다면 코드의 중복이 사라진다. 두 종류의 객체를 바꿔 끼울 수 있는 슬롯이면서, 두 종류의 객체를 포괄하는 추상화가 바로 **역할**이다.
